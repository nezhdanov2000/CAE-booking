# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º—Å–ª–æ—Ç–æ–≤ - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Linux

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Ç–∞–π–º—Å–ª–æ—Ç—ã —Å—Ç–∞—Ä—à–µ –æ–¥–Ω–æ–π –Ω–µ–¥–µ–ª–∏ –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 02:00 —á–µ—Ä–µ–∑ cron job.

## üõ†Ô∏è –§–∞–π–ª—ã

- `auto_cleanup_timeslots.php` - –û—Å–Ω–æ–≤–Ω–æ–π PHP —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏
- `auto_cleanup.log` - –õ–æ–≥ —Ñ–∞–π–ª (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cron Job

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ crontab –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
crontab -e
```

### 2. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º—Å–ª–æ—Ç–æ–≤ –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 02:00
0 2 * * 0 cd /path/to/your/cae/backend/admin && /usr/bin/php auto_cleanup_timeslots.php >> auto_cleanup.log 2>&1
```

### 3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:

```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00
0 2 * * * cd /path/to/your/cae/backend/admin && /usr/bin/php auto_cleanup_timeslots.php >> auto_cleanup.log 2>&1

# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
0 */6 * * * cd /path/to/your/cae/backend/admin && /usr/bin/php auto_cleanup_timeslots.php >> auto_cleanup.log 2>&1

# –ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 03:00
0 3 * * 1 cd /path/to/your/cae/backend/admin && /usr/bin/php auto_cleanup_timeslots.php >> auto_cleanup.log 2>&1
```

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:

```bash
cd /path/to/your/cae/backend/admin
php auto_cleanup_timeslots.php
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:

```bash
tail -f auto_cleanup.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ cron job:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ cron jobs
crontab -l

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cron
sudo tail -f /var/log/cron
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

- **PHP –ª–æ–≥:** `auto_cleanup.log` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Cron –ª–æ–≥:** `/var/log/cron` - –ª–æ–≥–∏ cron daemon

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—á–∏—Å—Ç–∫–∏
SELECT * FROM Admin_Log 
WHERE Action = 'Auto Cleanup Timeslots' 
ORDER BY Timestamp DESC 
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
SELECT 
    DATE(Timestamp) as Date,
    COUNT(*) as CleanupCount,
    SUM(CASE WHEN Details LIKE '%Successfully%' THEN 1 ELSE 0 END) as SuccessCount
FROM Admin_Log 
WHERE Action = 'Auto Cleanup Timeslots'
GROUP BY DATE(Timestamp)
ORDER BY Date DESC;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü—É—Ç–∏:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç–∏ –∫ PHP –∏ —Ñ–∞–π–ª–∞–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
2. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å cron –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º
3. **–í—Ä–µ–º—è:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è (02:00)
4. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∑–∞–ø—É—Å–∫:

```bash
crontab -e
# –ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∞:
0 2 * * * cd /path/to/your/cae/backend/admin && /usr/bin/php auto_cleanup_timeslots.php >> auto_cleanup.log 2>&1
```

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:

```bash
crontab -e
# –ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∞:
0 3 * * 0 cd /path/to/your/cae/backend/admin && /usr/bin/php auto_cleanup_timeslots.php >> auto_cleanup.log 2>&1
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: Cron job –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å cron job: `crontab -l`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron: `sudo tail -f /var/log/cron`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ cron daemon –∑–∞–ø—É—â–µ–Ω: `sudo systemctl status cron`

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –ª–æ–≥–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —É–¥–∞–ª—è–µ—Ç—Å—è –Ω–∏—á–µ–≥–æ
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—É cutoff (–Ω–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç–∞–π–º—Å–ª–æ—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã –≤ –ª–æ–≥–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: PHP –Ω–µ –Ω–∞–π–¥–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:**
1. –ù–∞–π–¥–∏—Ç–µ –ø—É—Ç—å –∫ PHP: `which php`
2. –û–±–Ω–æ–≤–∏—Ç–µ cron job —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—É—Ç–µ–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PHP CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

## üìù –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/html/cae/backend/admin

# 2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x auto_cleanup_timeslots.php

# 3. –û—Ç–∫—Ä–æ–π—Ç–µ crontab
crontab -e

# 4. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É
0 2 * * 0 cd /var/www/html/cae/backend/admin && /usr/bin/php auto_cleanup_timeslots.php >> auto_cleanup.log 2>&1

# 5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –≤—ã–π–¥–∏—Ç–µ
# (Ctrl+X, –∑–∞—Ç–µ–º Y, –∑–∞—Ç–µ–º Enter –≤ nano)

# 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cron job –¥–æ–±–∞–≤–ª–µ–Ω
crontab -l

# 7. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é
php auto_cleanup_timeslots.php

# 8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f auto_cleanup.log
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º:**
```bash
chmod 600 auto_cleanup.log
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤:**
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ /etc/logrotate.d/cae_cleanup
/var/www/html/cae/backend/admin/auto_cleanup.log {
    daily
    missingok
    rotate 7
    compress
    notifempty
}
```
