# Система регулярных занятий (Recurring Slots)

## Описание

Система позволяет репетиторам создавать регулярные занятия, которые автоматически повторяются каждую неделю. Это избавляет от необходимости создавать отдельные таймслоты для каждого занятия.

## Компоненты системы

### 1. База данных
- Таблица `Recurring_Slots` - хранит шаблоны регулярных занятий
- Связь с существующими таблицами `Tutor`, `Course`, `Timeslot`

### 2. Frontend
- `create_recurring_slots.html` - создание новых регулярных занятий
- `manage_recurring_slots.html` - управление существующими регулярными занятиями
- Кнопки в `dashboard.html` для доступа к функциям

### 3. Backend
- `create_recurring_slot.php` - создание регулярного занятия
- `get_recurring_slots.php` - получение списка регулярных занятий
- `toggle_recurring_slot.php` - активация/деактивация занятий
- `delete_recurring_slot.php` - удаление регулярных занятий
- `generate_weekly_slots.php` - автоматическая генерация таймслотов

## Настройка автоматической генерации

### Для Windows (Task Scheduler)

1. Откройте "Планировщик задач" (Task Scheduler)
2. Создайте новую задачу:
   - **Триггер**: Еженедельно, воскресенье в 00:00
   - **Действие**: Запустить программу
   - **Программа**: `C:\xampp\php\php.exe`
   - **Аргументы**: `C:\xampp\htdocs\CAE\backend\tutor\generate_weekly_slots.php`

### Для Linux (Cron)

Добавьте в crontab (`crontab -e`):
```bash
# Генерировать таймслоты каждое воскресенье в 00:00
0 0 * * 0 /usr/bin/php /path/to/CAE/backend/tutor/generate_weekly_slots.php
```

### Для macOS (Cron)

Аналогично Linux, но убедитесь, что PHP доступен в PATH:
```bash
# Генерировать таймслоты каждое воскресенье в 00:00
0 0 * * 0 /usr/bin/php /path/to/CAE/backend/tutor/generate_weekly_slots.php
```

## Ручная генерация

Для тестирования или ручной генерации таймслотов выполните:
```bash
php backend/tutor/generate_weekly_slots.php
```

## Логирование

Скрипт `generate_weekly_slots.php` выводит информацию о созданных таймслотах в консоль. Для продакшена рекомендуется перенаправить вывод в лог-файл:

```bash
php generate_weekly_slots.php >> /var/log/cae_recurring_slots.log 2>&1
```

## Безопасность

- Все операции проверяют права доступа пользователя
- Репетиторы могут управлять только своими регулярными занятиями
- Валидация всех входных данных
- Защита от SQL-инъекций через подготовленные запросы

## Возможные улучшения

1. **Уведомления**: Отправка email/SMS при создании новых таймслотов
2. **Исключения**: Возможность исключить определенные даты (праздники, отпуска)
3. **Повторения**: Более сложные паттерны повторений (каждые 2 недели, только в определенные месяцы)
4. **Массовые операции**: Создание нескольких регулярных занятий одновременно
5. **Статистика**: Отчеты по использованию регулярных занятий

## Устранение неполадок

### Проблема: Таймслоты не создаются автоматически
**Решение**: 
1. Проверьте права доступа к файлу `generate_weekly_slots.php`
2. Убедитесь, что cron/task scheduler настроен правильно
3. Проверьте логи на наличие ошибок

### Проблема: Ошибка "Database connection failed"
**Решение**:
1. Проверьте настройки подключения к БД в `db_connection.php`
2. Убедитесь, что MySQL сервер запущен
3. Проверьте права доступа пользователя БД

### Проблема: Дублирование таймслотов
**Решение**:
1. Скрипт автоматически проверяет существующие таймслоты
2. Если проблема повторяется, проверьте уникальность в таблице `Recurring_Slots`
